<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../static/layui/css/layui.css" th:href="@{/asserts/layui/css/layui.css}"><link rel="stylesheet" href="" th:href="@{/asserts/css/layui-theme-custom.css}">
    <link rel="stylesheet" href="../static/css/mystyle.css" th:href="@{/asserts/css/mystyle.css}">
    <script type="text/javascript" th:src="@{/asserts/js/wangEditor.min.js}"></script>
    <title>发布新闻</title>
    <style type="text/css">
        .toolbar {
            border: 1px solid #ccc;
            background-color: #eeeeee;
            padding-top: 4px;
        }

        .text {
            border: 1px solid #ccc;
            height: 1000px;
        }

        .layui-form-select dl {
            z-index: 10006;
        }
    </style>
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div th:replace="commons/bar::topbar"></div>

    <div th:replace="commons/bar::sidebar(activeUri='news.html')"></div>

    <div class="layui-body" style="margin-right: 30px;">
        <div style="padding: 50px;">
            <form action="#" th:action="@{/news}" method="post" class="layui-form" id="newNews">
                <input type="hidden" name="authorId" th:value="${session.admin.id}">
                <input type="hidden" name="click" value="0">
                <div class="layui-form-item">
                    <label class="layui-form-label">新闻标题</label>
                    <div class="layui-input-block">
                        <input autocomplete="off" type="text" name="title" id="title" class="layui-input" placeholder=" 请输入标题...">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">文章分类</label>
                    <div class="layui-input-block layui-form-select">
                        <select name="type" id="type" lay-filter="aihao" th:required="required">
                            <option value=""> -- 请选择类别 -- </option>
                            <option th:each="c:${session.allType}"  th:value="${c.classification}" th:text="${c.classification}" value="1">蔬菜</option>
                            <!--<option  value=""></option>-->
                            <!--<option th:selected="${news.type} eq 0" value="0">写作</option>-->
                            <!--<option th:selected="${news.type} eq 1" value="1">阅读</option>-->
                            <!--<option th:selected="${news.type} eq 2" value="2">游戏</option>-->
                            <!--<option th:selected="${news.type} eq 3" value="3">音乐</option>-->
                            <!--<option th:selected="${news.type} eq 4" value="4">旅行</option>-->
                        </select>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">新闻主体</label>
                    <div class="layui-input-block">
                        <div id="div1" class="toolbar">
                        </div>
                        <!--<div style="padding: 5px 0; color: #ccc">中间隔离带</div>-->
                        <div id="div2" class="text"> <!--可使用 min-height 实现编辑区域自动增加高度-->
                        </div>
                        <!--<textarea style="display: none" id="demo" name="content" lay-verify="content"></textarea>-->
                        <input type="hidden" value="" name="content" id="content">
                        <script type="text/javascript">
                            var E = window.wangEditor;
                            var editor = new E('#div1', '#div2'); // 两个参数也可以传入 elem 对象，class 选择器
                            editor.customConfig.uploadImgShowBase64 = true;
                            // 或者 var editor = new E( document.getElementById('editor') )
                            editor.create();

                        </script>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" id="sub" type="submit" lay-filter="formDemo"><i
                                class="layui-icon layui-icon-release"></i>立即发表
                        </button>
                        <button type="reset" class="layui-btn layui-btn-primary" onclick="editor.txt.clear();"><i
                                class="layui-icon layui-icon-refresh"></i>重置
                        </button>
                    </div>
                </div>
            </form>

        </div>
    </div>
    <div th:replace="commons/bar::footer"></div>
</div>
<script src="../static/layui/layui.js" th:src="@{/asserts/layui/layui.js}"></script>
<script type="text/javascript" src="asserts/js/jquery-3.2.1.slim.min.js"
        th:src="@{webjars/jquery/3.3.1/jquery.min.js}"></script>
<script th:src="@{/asserts/js/myjs.js}"></script>

<script>
    //JavaScript代码区域
    layui.use(['element', 'form'], function () {
        var element = layui.element;
        var form = layui.form;
            document.getElementById('sub').addEventListener('click', function (event) {//注意，此方法没有返回值，只能用preventDefault阻止提交
            var title = document.getElementById('title').value;
            var type = document.getElementById('type').value;
            if (title==""){
                layer.msg("标题不能为空");
                event.preventDefault();
            }else if (type=='') {
                //读取html
                layer.msg("请选择一个类别");
                event.preventDefault();
            }else if (checkVal(editor.txt.html())){
                layer.msg("内容不能为空");
                event.preventDefault();
            } else {
                layer.msg("文章发布成功");
                document.getElementById('content').value = editor.txt.html();
            }
        }, false)

        function checkVal(str){
            let num = 0;
            reg = /<p>(&nbsp;|&nbsp;\s+)+<\/p>|<p>(<br>)+<\/p>/g;
            while (num < str.length && str != "")
            {
                num++;
                let k = str.match(reg);
                if (k) {
                    str = str.replace(k[0], "");
                }
            }
            return str == "";
        }
    });



</script>
</body>
</html>